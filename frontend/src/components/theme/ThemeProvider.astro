---
/**
 * ThemeProvider - Componente que carga y aplica el tema activo
 * Se incluye en todos los layouts para inyectar CSS Variables y fuentes
 * Soporta multi-tenant para cargar tema del tenant específico
 */

import { loadSiteConfig, generateCSSVariables, getGoogleFontsUrl } from '@/utils/theme/themeLoader';
import type { TenantContext } from '@/types';

interface Props {
  tenant: TenantContext;
}

const { tenant } = Astro.props;

// Cargar configuración del sitio con tema activo del tenant
const config = await loadSiteConfig(tenant.id, tenant.dominio);
const theme = config.temaActivo;

// Generar CSS Variables del tema del tenant
const cssVars = generateCSSVariables(theme);

// URL de Google Fonts
const googleFontsUrl = getGoogleFontsUrl(theme);
---

<!-- Preconnect para mejor performance -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- Cargar Google Fonts -->
<link href={googleFontsUrl} rel="stylesheet" />

<!-- Inyectar CSS Variables del tema -->
<style is:global set:html={cssVars}></style>

<!-- Script para hacer config disponible globalmente -->
<script define:vars={{ config, theme }}>
  // Hacer configuración disponible para JavaScript del cliente
  window.__SITE_CONFIG__ = config;
  window.__ACTIVE_THEME__ = theme;
</script>
